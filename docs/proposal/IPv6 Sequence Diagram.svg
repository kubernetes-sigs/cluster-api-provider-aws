<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1028px" preserveAspectRatio="none" style="width:1793px;height:1028px;" version="1.1" viewBox="0 0 1793 1028" width="1793px" zoomAndPan="magnify"><defs><filter height="300%" id="f1kst26m2j77mz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="1013.1797" style="stroke: #A80036; stroke-width: 1.0;" width="1137" x="110.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="167" x="595.5" y="16.0669">CAPA Internal Services</text><rect fill="#90EE90" height="1013.1797" style="stroke: #A80036; stroke-width: 1.0;" width="53" x="1411.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="1421.5" y="16.0669">AWS</text><rect fill="#FFFFFF" filter="url(#f1kst26m2j77mz)" height="681.0547" style="stroke: #000000; stroke-width: 2.0;" width="1544.5" x="229.5" y="161.5625"/><rect fill="#FFFFFF" height="118.5313" style="stroke: none; stroke-width: 1.0;" width="1544.5" x="229.5" y="724.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="149.5" x2="149.5" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="314.5" x2="314.5" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="594" x2="594" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="777" x2="777" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1193.5" x2="1193.5" y1="86.2969" y2="930.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1437.5" x2="1437.5" y1="86.2969" y2="930.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FFA500" filter="url(#f1kst26m2j77mz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="none" filter="url(#f1kst26m2j77mz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="942.8779">User</text><ellipse cx="27" cy="956.1797" fill="#FFA500" filter="url(#f1kst26m2j77mz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,964.1797 L27,991.1797 M14,972.1797 L40,972.1797 M27,991.1797 L14,1006.1797 M27,991.1797 L40,1006.1797 " fill="none" filter="url(#f1kst26m2j77mz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="114.5" y="82.9951">APIServer</text><path d="M132,34 C132,24 150,24 150,24 C150,24 168,24 168,34 L168,60 C168,70 150,70 150,70 C150,70 132,70 132,60 L132,34 " fill="#FEFECE" filter="url(#f1kst26m2j77mz)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M132,34 C132,44 150,44 150,44 C150,44 168,44 168,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="114.5" y="942.8779">APIServer</text><path d="M132,956.1797 C132,946.1797 150,946.1797 150,946.1797 C150,946.1797 168,946.1797 168,956.1797 L168,982.1797 C168,992.1797 150,992.1797 150,992.1797 C150,992.1797 132,992.1797 132,982.1797 L132,956.1797 " fill="#FEFECE" filter="url(#f1kst26m2j77mz)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M132,956.1797 C132,966.1797 150,966.1797 150,966.1797 C150,966.1797 168,966.1797 168,956.1797 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="239.5" y="82.9951">InfraClusterController</text><ellipse cx="315" cy="54" fill="#FEFECE" filter="url(#f1kst26m2j77mz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="311,42,317,37,315,42,317,47,311,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="239.5" y="942.8779">InfraClusterController</text><ellipse cx="315" cy="962.1797" fill="#FEFECE" filter="url(#f1kst26m2j77mz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="311,950.1797,317,945.1797,315,950.1797,317,955.1797,311,950.1797" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="529" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="70.9951">network_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="529" y="929.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="949.8779">network_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="705" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="712" y="70.9951">aws_node_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="705" y="929.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="712" y="949.8779">aws_node_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1144.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1151.5" y="70.9951">eks_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1144.5" y="929.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1151.5" y="949.8779">eks_service</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1415.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1422.5" y="70.9951">aws</text><rect fill="#FEFECE" filter="url(#f1kst26m2j77mz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1415.5" y="929.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1422.5" y="949.8779">aws</text><polygon fill="#A80036" points="138,113.4297,148,117.4297,138,121.4297,142,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="144" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="34" y="112.3638">apply capi yaml</text><polygon fill="#A80036" points="161,142.5625,151,146.5625,161,150.5625,157,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="314" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="167" y="141.4966">watch (create/update)</text><path d="M229.5,161.5625 L299.5,161.5625 L299.5,168.5625 L289.5,178.5625 L229.5,178.5625 L229.5,161.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="681.0547" style="stroke: #000000; stroke-width: 2.0;" width="1544.5" x="229.5" y="161.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="244.5" y="174.6294">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="314.5" y="173.7729">[if ipv6 network requested]</text><polygon fill="#A80036" points="582,195.8281,592,199.8281,582,203.8281,586,199.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="588" y1="199.8281" y2="199.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="322" y="194.7622">Create a VPC with IPFamily set to `ipv6`</text><polygon fill="#A80036" points="1426,224.9609,1436,228.9609,1426,232.9609,1430,228.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="594" x2="1432" y1="228.9609" y2="228.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="601" y="223.895">Create a VPC with IPFamily set to `ipv6`</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1438" x2="1480" y1="258.0938" y2="258.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1480" x2="1480" y1="258.0938" y2="271.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439" x2="1480" y1="271.0938" y2="271.0938"/><polygon fill="#A80036" points="1449,267.0938,1439,271.0938,1449,275.0938,1445,271.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="317" x="1445" y="253.0278">Create IPv6 Pool and assign IPv6 CIDR to new VPC</text><polygon fill="#A80036" points="605,316.3594,595,320.3594,605,324.3594,601,320.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="1437" y1="320.3594" y2="320.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="611" y="315.2935">return the VPC</text><path d="M1443,284.0938 L1443,339.0938 L1708,339.0938 L1708,294.0938 L1698,284.0938 L1443,284.0938 " fill="#FBFB77" filter="url(#f1kst26m2j77mz)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1698,284.0938 L1698,294.0938 L1708,294.0938 L1698,284.0938 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="1449" y="301.1606">"At this point, CIDR and Pool aren't yet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1453" y="316.2935">set on the returned VPC.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="1453" y="331.4263">We must Describe it to get that."</text><polygon fill="#A80036" points="1426,365.625,1436,369.625,1426,373.625,1430,369.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="594" x2="1432" y1="369.625" y2="369.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="601" y="364.5591">`DescribeVpcs` to get IPv6 CIDR and Pool ID</text><polygon fill="#A80036" points="605,394.7578,595,398.7578,605,402.7578,601,398.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="1437" y1="398.7578" y2="398.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="611" y="393.6919">return VPC with IPv6 CIDR and Pool now set</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="594" x2="636" y1="427.8906" y2="427.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636" x2="636" y1="427.8906" y2="440.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="595" x2="636" y1="440.8906" y2="440.8906"/><polygon fill="#A80036" points="605,436.8906,595,440.8906,605,444.8906,601,440.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="601" y="422.8247">update internal VPC config</text><polygon fill="#A80036" points="326,466.0234,316,470.0234,326,474.0234,322,470.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="320" x2="593" y1="470.0234" y2="470.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="332" y="464.9575">VPC successfully reconciled</text><polygon fill="#A80036" points="765,495.1563,775,499.1563,765,503.1563,769,499.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="771" y1="499.1563" y2="499.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="322" y="494.0903">patch aws-node with IPv6 environment properties</text><polygon fill="#A80036" points="582,524.2891,592,528.2891,582,532.2891,586,528.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="588" y1="528.2891" y2="528.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="322" y="523.2231">reconcile EgressOnlyInternetGateway</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="777" x2="819" y1="557.4219" y2="557.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="819" x2="819" y1="557.4219" y2="570.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778" x2="819" y1="570.4219" y2="570.4219"/><polygon fill="#A80036" points="788,566.4219,778,570.4219,788,574.4219,784,570.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="403" x="784" y="552.356">update aws-node DaemonSet with new environment properties</text><polygon fill="#A80036" points="1182,595.5547,1192,599.5547,1182,603.5547,1186,599.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="1188" y1="599.5547" y2="599.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="322" y="594.4888">set up IPv6 bootstrap properties</text><polygon fill="#A80036" points="1182,624.6875,1192,628.6875,1182,632.6875,1186,628.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="1188" y1="628.6875" y2="628.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="322" y="623.6216">create cluster and provision nodes</text><polygon fill="#A80036" points="1426,653.8203,1436,657.8203,1426,661.8203,1430,657.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1194" x2="1432" y1="657.8203" y2="657.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="1201" y="652.7544">create cluster and provision nodes</text><polygon fill="#A80036" points="1205,682.9531,1195,686.9531,1205,690.9531,1201,686.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1199" x2="1437" y1="686.9531" y2="686.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="1211" y="681.8872">ok</text><polygon fill="#A80036" points="326,712.0859,316,716.0859,326,720.0859,322,716.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="320" x2="1193" y1="716.0859" y2="716.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="332" y="711.02">ok</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="229.5" x2="1774" y1="725.0859" y2="725.0859"/><polygon fill="#A80036" points="582,743.2188,592,747.2188,582,751.2188,586,747.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="588" y1="747.2188" y2="747.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="322" y="742.1528">normal cluster flow</text><polygon fill="#A80036" points="1426,772.3516,1436,776.3516,1426,780.3516,1430,776.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="594" x2="1432" y1="776.3516" y2="776.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="601" y="771.2856">normal cluster flow</text><polygon fill="#A80036" points="605,801.4844,595,805.4844,605,809.4844,601,805.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="1437" y1="805.4844" y2="805.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="611" y="800.4185">ok</text><polygon fill="#A80036" points="326,830.6172,316,834.6172,326,838.6172,322,834.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="320" x2="593" y1="834.6172" y2="834.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="332" y="829.5513">ok</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="357" y1="870.75" y2="870.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="357" y1="870.75" y2="883.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="316" x2="357" y1="883.75" y2="883.75"/><polygon fill="#A80036" points="326,879.75,316,883.75,326,887.75,322,883.75" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="322" y="865.6841">update status</text><polygon fill="#A80036" points="161,908.8828,151,912.8828,161,916.8828,157,912.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="314" y1="912.8828" y2="912.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="167" y="907.8169">patch</text><!--MD5=[9c7c20b0f453a2e78619860faff1d1bf]
@startuml "IPv6 Sequence Diagram"
actor User #orange
box "CAPA Internal Services" #LightBlue
database APIServer
control InfraClusterController
participant network_service
participant aws_node_service
participant eks_service
end box
box "AWS" #LightGreen
participant aws
end box

User -> APIServer: apply capi yaml
InfraClusterController -> APIServer: watch (create/update)
opt if ipv6 network requested
    InfraClusterController -> network_service: Create a VPC with IPFamily set to `ipv6`
    network_service -> aws: Create a VPC with IPFamily set to `ipv6`
    aws -> aws: Create IPv6 Pool and assign IPv6 CIDR to new VPC
    aws -> network_service: return the VPC
    note right: "At this point, CIDR and Pool aren't yet\n set on the returned VPC.\n We must Describe it to get that."
    network_service -> aws: `DescribeVpcs` to get IPv6 CIDR and Pool ID
    aws->network_service: return VPC with IPv6 CIDR and Pool now set
    network_service -> network_service: update internal VPC config
    network_service -> InfraClusterController: VPC successfully reconciled
    InfraClusterController -> aws_node_service: patch aws-node with IPv6 environment properties
    InfraClusterController -> network_service: reconcile EgressOnlyInternetGateway
    aws_node_service -> aws_node_service: update aws-node DaemonSet with new environment properties
    InfraClusterController -> eks_service: set up IPv6 bootstrap properties
    InfraClusterController -> eks_service: create cluster and provision nodes
    eks_service -> aws: create cluster and provision nodes
    aws -> eks_service: ok
    eks_service -> InfraClusterController: ok
else
    InfraClusterController -> network_service: normal cluster flow
    network_service -> aws: normal cluster flow
    aws -> network_service: ok
    network_service -> InfraClusterController: ok
end
InfraClusterController -> InfraClusterController: update status
InfraClusterController -> APIServer: patch
deactivate InfraClusterController
@enduml

PlantUML version 1.2020.16(Sun Aug 23 20:20:43 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
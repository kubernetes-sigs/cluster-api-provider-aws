<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="575px" preserveAspectRatio="none" style="width:852px;height:575px;" version="1.1" viewBox="0 0 852 575" width="852px" zoomAndPan="magnify"><defs><filter height="300%" id="f939oq1i4ykc5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f939oq1i4ykc5)" height="323.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="336" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f939oq1i4ykc5)" height="121.5313" style="stroke: #000000; stroke-width: 2.0;" width="490" x="255.5" y="203.6953"/><rect fill="#FFFFFF" filter="url(#f939oq1i4ykc5)" height="61.2656" style="stroke: #000000; stroke-width: 2.0;" width="256" x="479.5" y="256.9609"/><rect fill="#FFFFFF" height="44.1328" style="stroke: none; stroke-width: 1.0;" width="256" x="479.5" y="274.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="86.2969" y2="487.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="162.5" x2="162.5" y1="86.2969" y2="487.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="340.5" x2="340.5" y1="86.2969" y2="487.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="534.5" x2="534.5" y1="86.2969" y2="487.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="657.5" x2="657.5" y1="86.2969" y2="487.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="814.5" x2="814.5" y1="86.2969" y2="487.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FEFECE" filter="url(#f939oq1i4ykc5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="none" filter="url(#f939oq1i4ykc5)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="499.8857">User</text><ellipse cx="27" cy="513.1875" fill="#FEFECE" filter="url(#f939oq1i4ykc5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,521.1875 L27,548.1875 M14,529.1875 L40,529.1875 M27,548.1875 L14,563.1875 M27,548.1875 L40,563.1875 " fill="none" filter="url(#f939oq1i4ykc5)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="127.5" y="82.9951">APIServer</text><path d="M145,34 C145,24 163,24 163,24 C163,24 181,24 181,34 L181,60 C181,70 163,70 163,70 C163,70 145,70 145,60 L145,34 " fill="#FEFECE" filter="url(#f939oq1i4ykc5)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M145,34 C145,44 163,44 163,44 C163,44 181,44 181,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="127.5" y="499.8857">APIServer</text><path d="M145,513.1875 C145,503.1875 163,503.1875 163,503.1875 C163,503.1875 181,503.1875 181,513.1875 L181,539.1875 C181,549.1875 163,549.1875 163,549.1875 C163,549.1875 145,549.1875 145,539.1875 L145,513.1875 " fill="#FEFECE" filter="url(#f939oq1i4ykc5)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M145,513.1875 C145,523.1875 163,523.1875 163,523.1875 C163,523.1875 181,523.1875 181,513.1875 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="265.5" y="82.9951">InfraClusterController</text><ellipse cx="341" cy="54" fill="#FEFECE" filter="url(#f939oq1i4ykc5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="337,42,343,37,341,42,343,47,337,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="265.5" y="499.8857">InfraClusterController</text><ellipse cx="341" cy="519.1875" fill="#FEFECE" filter="url(#f939oq1i4ykc5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="337,507.1875,343,502.1875,341,507.1875,343,512.1875,337,507.1875" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="489.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="496.5" y="70.9951">gc_service</text><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="489.5" y="486.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="496.5" y="506.8857">gc_service</text><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="600.5" y="47"/><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="596.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="603.5" y="70.9951">other_services</text><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="600.5" y="486.8906"/><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="596.5" y="490.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="603.5" y="510.8857">other_services</text><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="792.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="799.5" y="70.9951">aws</text><rect fill="#FEFECE" filter="url(#f939oq1i4ykc5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="792.5" y="486.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="799.5" y="506.8857">aws</text><rect fill="#FFFFFF" filter="url(#f939oq1i4ykc5)" height="323.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="336" y="146.5625"/><polygon fill="#A80036" points="151,113.4297,161,117.4297,151,121.4297,155,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="157" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="47" y="112.3638">apply capi yaml</text><polygon fill="#A80036" points="174,142.5625,164,146.5625,174,150.5625,170,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="335" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="180" y="141.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="193" y="141.4966">watch (create/update)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="388" y1="175.6953" y2="175.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="388" x2="388" y1="175.6953" y2="188.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="388" y1="188.6953" y2="188.6953"/><polygon fill="#A80036" points="357,184.6953,347,188.6953,357,192.6953,353,188.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="353" y="170.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="366" y="170.6294">Add infra cluster finalizer</text><path d="M255.5,203.6953 L325.5,203.6953 L325.5,210.6953 L315.5,220.6953 L255.5,220.6953 L255.5,203.6953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5313" style="stroke: #000000; stroke-width: 2.0;" width="490" x="255.5" y="203.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="270.5" y="216.7622">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="340.5" y="215.9058">[if gc feature enabled]</text><polygon fill="#A80036" points="523,237.9609,533,241.9609,523,245.9609,527,241.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="529" y1="241.9609" y2="241.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="353" y="236.895">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="366" y="236.895">Reconcile</text><path d="M479.5,256.9609 L549.5,256.9609 L549.5,263.9609 L539.5,273.9609 L479.5,273.9609 L479.5,256.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="61.2656" style="stroke: #000000; stroke-width: 2.0;" width="256" x="479.5" y="256.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="494.5" y="270.0278">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="564.5" y="269.1714">[if gc annotation != false]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="479.5" x2="735.5" y1="275.0938" y2="275.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="535" x2="577" y1="297.2266" y2="297.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="577" x2="577" y1="297.2266" y2="310.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="536" x2="577" y1="310.2266" y2="310.2266"/><polygon fill="#A80036" points="546,306.2266,536,310.2266,546,314.2266,542,310.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="542" y="292.1606">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="555" y="292.1606">add gc finalizer</text><polygon fill="#A80036" points="174,349.3594,164,353.3594,174,357.3594,170,353.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="335" y1="353.3594" y2="353.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="180" y="348.2935">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="193" y="348.2935">patch infracluster</text><polygon fill="#A80036" points="646,378.4922,656,382.4922,646,386.4922,650,382.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="652" y1="382.4922" y2="382.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="353" y="377.4263">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="366" y="377.4263">Reconcile</text><polygon fill="#A80036" points="803,407.625,813,411.625,803,415.625,807,411.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658" x2="809" y1="411.625" y2="411.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="665" y="406.5591">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="678" y="406.5591">create cluster infra</text><polygon fill="#A80036" points="357,436.7578,347,440.7578,357,444.7578,353,440.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="657" y1="440.7578" y2="440.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="435.6919">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="376" y="435.6919">update status</text><polygon fill="#A80036" points="174,465.8906,164,469.8906,174,473.8906,170,469.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="340" y1="469.8906" y2="469.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="180" y="464.8247">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="202" y="464.8247">patch</text><!--MD5=[82830ec3b0b7f864b9cf225c52cd15e2]
@startuml
autonumber
actor User
database APIServer
control InfraClusterController
participant gc_service
collections other_services
participant aws
User -> APIServer: apply capi yaml
InfraClusterController -> APIServer: watch (create/update)
activate InfraClusterController
InfraClusterController -> InfraClusterController: Add infra cluster finalizer
opt if gc feature enabled
    InfraClusterController -> gc_service: Reconcile
    opt if gc annotation != false
    else
        gc_service -> gc_service: add gc finalizer
    end
end
InfraClusterController -> APIServer: patch infracluster
InfraClusterController -> other_services: Reconcile
other_services -> aws: create cluster infra
other_services -> InfraClusterController: update status
InfraClusterController -> APIServer: patch
deactivate InfraClusterController
@enduml

PlantUML version 1.2020.16(Sun Aug 23 20:20:43 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="660px" preserveAspectRatio="none" style="width:1180px;height:660px;" version="1.1" viewBox="0 0 1180 660" width="1180px" zoomAndPan="magnify"><defs><filter height="300%" id="fox0xmxw5ju6s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="366.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368" y="146.5625"/><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="308.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="204.8281"/><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="106.5313" style="stroke: #000000; stroke-width: 2.0;" width="736.5" x="425" y="278.0938"/><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="513.5" x="638" y="331.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="150.5" x2="150.5" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="373" x2="373" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="510" x2="510" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693" x2="693" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="810" x2="810" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="947" x2="947" y1="86.2969" y2="573.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1118.5" x2="1118.5" y1="86.2969" y2="573.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="none" filter="url(#fox0xmxw5ju6s)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="585.2842">User</text><ellipse cx="27" cy="598.5859" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,606.5859 L27,633.5859 M14,614.5859 L40,614.5859 M27,633.5859 L14,648.5859 M27,633.5859 L40,648.5859 " fill="none" filter="url(#fox0xmxw5ju6s)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="115.5" y="82.9951">APIServer</text><path d="M133,34 C133,24 151,24 151,24 C151,24 169,24 169,34 L169,60 C169,70 151,70 151,70 C151,70 133,70 133,60 L133,34 " fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M133,34 C133,44 151,44 151,44 C151,44 169,44 169,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="115.5" y="585.2842">APIServer</text><path d="M133,598.5859 C133,588.5859 151,588.5859 151,588.5859 C151,588.5859 169,588.5859 169,598.5859 L169,624.5859 C169,634.5859 151,634.5859 151,634.5859 C151,634.5859 133,634.5859 133,624.5859 L133,598.5859 " fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M133,598.5859 C133,608.5859 151,608.5859 151,608.5859 C151,608.5859 169,608.5859 169,598.5859 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="321" y="82.9951">CAPIController</text><ellipse cx="373" cy="54" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="369,42,375,37,373,42,375,47,369,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="321" y="585.2842">CAPIController</text><ellipse cx="373" cy="604.5859" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="369,592.5859,375,587.5859,373,592.5859,375,597.5859,369,592.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="435" y="82.9951">InfraClusterController</text><ellipse cx="510.5" cy="54" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="506.5,42,512.5,37,510.5,42,512.5,47,506.5,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="435" y="585.2842">InfraClusterController</text><ellipse cx="510.5" cy="604.5859" fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="506.5,592.5859,512.5,587.5859,510.5,592.5859,512.5,597.5859,506.5,592.5859" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="648" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="655" y="70.9951">gc_service</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="648" y="572.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="655" y="592.2842">gc_service</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="753" y="47"/><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="749" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="756" y="70.9951">other_services</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="753" y="572.2891"/><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="749" y="576.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="756" y="596.2842">other_services</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="882" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="889" y="70.9951">network_service</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="882" y="572.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="889" y="592.2842">network_service</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1096.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1103.5" y="70.9951">aws</text><rect fill="#FEFECE" filter="url(#fox0xmxw5ju6s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1096.5" y="572.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1103.5" y="592.2842">aws</text><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="366.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368" y="146.5625"/><rect fill="#FFFFFF" filter="url(#fox0xmxw5ju6s)" height="308.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="204.8281"/><polygon fill="#A80036" points="139,113.4297,149,117.4297,139,121.4297,143,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="145" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="47" y="112.3638">delete cluster</text><polygon fill="#A80036" points="162,142.5625,152,146.5625,162,150.5625,158,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="367" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="141.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="181" y="141.4966">watch</text><polygon fill="#A80036" points="162,171.6953,152,175.6953,162,179.6953,158,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="367" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="170.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="181" y="170.6294">delete infra (set timestamp)</text><polygon fill="#A80036" points="162,200.8281,152,204.8281,162,208.8281,158,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="504.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="199.7622">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="181" y="199.7622">watch (delete)</text><polygon fill="#A80036" points="798.5,229.9609,808.5,233.9609,798.5,237.9609,802.5,233.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="804.5" y1="233.9609" y2="233.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="522.5" y="228.895">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="535.5" y="228.895">Reconcile Delete</text><polygon fill="#A80036" points="1107,259.0938,1117,263.0938,1107,267.0938,1111,263.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="810.5" x2="1113" y1="263.0938" y2="263.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="817.5" y="258.0278">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="830.5" y="258.0278">Delete non-network infra</text><path d="M425,278.0938 L495,278.0938 L495,285.0938 L485,295.0938 L425,295.0938 L425,278.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.5313" style="stroke: #000000; stroke-width: 2.0;" width="736.5" x="425" y="278.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="440" y="291.1606">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="510" y="290.3042">[if gc feature enabled]</text><polygon fill="#A80036" points="681.5,312.3594,691.5,316.3594,681.5,320.3594,685.5,316.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="687.5" y1="316.3594" y2="316.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="522.5" y="311.2935">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="535.5" y="311.2935">ReconcileDelete</text><path d="M638,331.3594 L708,331.3594 L708,338.3594 L698,348.3594 L638,348.3594 L638,331.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="513.5" x="638" y="331.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="653" y="344.4263">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="723" y="343.5698">[if gc annotation != false OR ""]</text><polygon fill="#A80036" points="1107,365.625,1117,369.625,1107,373.625,1111,369.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="1113" y1="369.625" y2="369.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="700.5" y="364.5591">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="713.5" y="364.5591">Delete tenant created resources (lb/sg)</text><polygon fill="#A80036" points="935,408.7578,945,412.7578,935,416.7578,939,412.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="941" y1="412.7578" y2="412.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="522.5" y="407.6919">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="535.5" y="407.6919">Reconcile Delete</text><polygon fill="#A80036" points="1107,437.8906,1117,441.8906,1107,445.8906,1111,441.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="947" x2="1113" y1="441.8906" y2="441.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="954" y="436.8247">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="976" y="436.8247">delete network infra</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="557.5" y1="471.0234" y2="471.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="557.5" x2="557.5" y1="471.0234" y2="484.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="516.5" x2="557.5" y1="484.0234" y2="484.0234"/><polygon fill="#A80036" points="526.5,480.0234,516.5,484.0234,526.5,488.0234,522.5,484.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="522.5" y="465.9575">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="544.5" y="465.9575">Remove infra finalizer</text><polygon fill="#A80036" points="162,509.1563,152,513.1563,162,517.1563,158,513.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="509.5" y1="513.1563" y2="513.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="168" y="508.0903">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="190" y="508.0903">patch</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="193" y1="542.2891" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="193" x2="193" y1="542.2891" y2="555.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="152" x2="193" y1="555.2891" y2="555.2891"/><polygon fill="#A80036" points="162,551.2891,152,555.2891,162,559.2891,158,555.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="158" y="537.2231">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="180" y="537.2231">Delete infra cluster</text><!--MD5=[f624b5d1e087e53e2a5a435243911393]
@startuml
autonumber
actor User
database APIServer
control CAPIController
control InfraClusterController
participant gc_service
collections other_services
participant network_service
participant aws
User -> APIServer: delete cluster
CAPIController -> APIServer: watch
activate CAPIController
CAPIController -> APIServer: delete infra (set timestamp)

InfraClusterController -> APIServer: watch (delete)
activate InfraClusterController
InfraClusterController -> other_services: Reconcile Delete 
other_services -> aws: Delete non-network infra
opt if gc feature enabled
    InfraClusterController -> gc_service: ReconcileDelete
    opt if gc annotation != false OR ""
        gc_service -> aws: Delete tenant created resources (lb/sg)
    end
end
InfraClusterController -> network_service: Reconcile Delete
network_service -> aws: delete network infra
InfraClusterController -> InfraClusterController: Remove infra finalizer
InfraClusterController -> APIServer: patch
deactivate InfraClusterController
deactivate CAPIController
APIServer -> APIServer: Delete infra cluster

@enduml

PlantUML version 1.2020.16(Sun Aug 23 20:20:43 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
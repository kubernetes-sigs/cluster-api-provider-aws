<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="700px" preserveAspectRatio="none" style="width:1201px;height:700px;" version="1.1" viewBox="0 0 1201 700" width="1201px" zoomAndPan="magnify"><defs><filter height="300%" id="f1kv79i29jtbag" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1kv79i29jtbag)" height="406.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f1kv79i29jtbag)" height="348.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="204.8281"/><rect fill="#FFFFFF" filter="url(#f1kv79i29jtbag)" height="146.6641" style="stroke: #000000; stroke-width: 2.0;" width="1077" x="105.5" y="278.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="150.5" x2="150.5" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="373" x2="373" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="510" x2="510" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693" x2="693" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="841" x2="841" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="978" x2="978" y1="86.2969" y2="613.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1149.5" x2="1149.5" y1="86.2969" y2="613.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="none" filter="url(#f1kv79i29jtbag)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="625.417">User</text><ellipse cx="27" cy="638.7188" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,646.7188 L27,673.7188 M14,654.7188 L40,654.7188 M27,673.7188 L14,688.7188 M27,673.7188 L40,688.7188 " fill="none" filter="url(#f1kv79i29jtbag)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="115.5" y="82.9951">APIServer</text><path d="M133,34 C133,24 151,24 151,24 C151,24 169,24 169,34 L169,60 C169,70 151,70 151,70 C151,70 133,70 133,60 L133,34 " fill="#FEFECE" filter="url(#f1kv79i29jtbag)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M133,34 C133,44 151,44 151,44 C151,44 169,44 169,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="115.5" y="625.417">APIServer</text><path d="M133,638.7188 C133,628.7188 151,628.7188 151,628.7188 C151,628.7188 169,628.7188 169,638.7188 L169,664.7188 C169,674.7188 151,674.7188 151,674.7188 C151,674.7188 133,674.7188 133,664.7188 L133,638.7188 " fill="#FEFECE" filter="url(#f1kv79i29jtbag)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M133,638.7188 C133,648.7188 151,648.7188 151,648.7188 C151,648.7188 169,648.7188 169,638.7188 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="321" y="82.9951">CAPIController</text><ellipse cx="373" cy="54" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="369,42,375,37,373,42,375,47,369,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="321" y="625.417">CAPIController</text><ellipse cx="373" cy="644.7188" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="369,632.7188,375,627.7188,373,632.7188,375,637.7188,369,632.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="435" y="82.9951">InfraClusterController</text><ellipse cx="510.5" cy="54" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="506.5,42,512.5,37,510.5,42,512.5,47,506.5,42" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="435" y="625.417">InfraClusterController</text><ellipse cx="510.5" cy="644.7188" fill="#FEFECE" filter="url(#f1kv79i29jtbag)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="506.5,632.7188,512.5,627.7188,510.5,632.7188,512.5,637.7188,506.5,632.7188" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="648" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="655" y="70.9951">gc_service</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="648" y="612.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="655" y="632.417">gc_service</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="784" y="47"/><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="780" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="787" y="70.9951">other_services</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="784" y="612.4219"/><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="780" y="616.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="787" y="636.417">other_services</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="913" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="920" y="70.9951">network_service</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="913" y="612.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="920" y="632.417">network_service</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1127.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1134.5" y="70.9951">aws</text><rect fill="#FEFECE" filter="url(#f1kv79i29jtbag)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1127.5" y="612.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1134.5" y="632.417">aws</text><rect fill="#FFFFFF" filter="url(#f1kv79i29jtbag)" height="406.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f1kv79i29jtbag)" height="348.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="204.8281"/><polygon fill="#A80036" points="139,113.4297,149,117.4297,139,121.4297,143,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="145" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="47" y="112.3638">delete cluster</text><polygon fill="#A80036" points="162,142.5625,152,146.5625,162,150.5625,158,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="367" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="141.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="181" y="141.4966">watch</text><polygon fill="#A80036" points="162,171.6953,152,175.6953,162,179.6953,158,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="367" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="170.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="181" y="170.6294">delete infra (set timestamp)</text><polygon fill="#A80036" points="162,200.8281,152,204.8281,162,208.8281,158,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="504.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="168" y="199.7622">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="181" y="199.7622">watch (delete)</text><polygon fill="#A80036" points="829.5,229.9609,839.5,233.9609,829.5,237.9609,833.5,233.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="835.5" y1="233.9609" y2="233.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="522.5" y="228.895">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="535.5" y="228.895">Reconcile Delete</text><polygon fill="#A80036" points="1138,259.0938,1148,263.0938,1138,267.0938,1142,263.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="841.5" x2="1144" y1="263.0938" y2="263.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="848.5" y="258.0278">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="861.5" y="258.0278">Delete non-network infra</text><path d="M105.5,278.0938 L175.5,278.0938 L175.5,285.0938 L165.5,295.0938 L105.5,295.0938 L105.5,278.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.6641" style="stroke: #000000; stroke-width: 2.0;" width="1077" x="105.5" y="278.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="120.5" y="291.1606">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="190.5" y="290.3042">[if InfraCluster has gc finalizer]</text><polygon fill="#A80036" points="681.5,312.3594,691.5,316.3594,681.5,320.3594,685.5,316.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="687.5" y1="316.3594" y2="316.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="522.5" y="311.2935">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="535.5" y="311.2935">ReconcileDelete</text><polygon fill="#A80036" points="1138,341.4922,1148,345.4922,1138,349.4922,1142,345.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="1144" y1="345.4922" y2="345.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="700.5" y="340.4263">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="713.5" y="340.4263">Delete tenant created resources (lb/sg)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="735.5" y1="374.625" y2="374.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="735.5" x2="735.5" y1="374.625" y2="387.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="694.5" x2="735.5" y1="387.625" y2="387.625"/><polygon fill="#A80036" points="704.5,383.625,694.5,387.625,704.5,391.625,700.5,387.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="700.5" y="369.5591">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="713.5" y="369.5591">remove gc finalizer</text><polygon fill="#A80036" points="162,412.7578,152,416.7578,162,420.7578,158,416.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="692.5" y1="416.7578" y2="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="168" y="411.6919">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="190" y="411.6919">patch infracluster</text><polygon fill="#A80036" points="966,448.8906,976,452.8906,966,456.8906,970,452.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="972" y1="452.8906" y2="452.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="522.5" y="447.8247">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="544.5" y="447.8247">Reconcile Delete</text><polygon fill="#A80036" points="1138,478.0234,1148,482.0234,1138,486.0234,1142,482.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="978" x2="1144" y1="482.0234" y2="482.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="985" y="476.9575">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1007" y="476.9575">delete network infra</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="515.5" x2="557.5" y1="511.1563" y2="511.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="557.5" x2="557.5" y1="511.1563" y2="524.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="516.5" x2="557.5" y1="524.1563" y2="524.1563"/><polygon fill="#A80036" points="526.5,520.1563,516.5,524.1563,526.5,528.1563,522.5,524.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="522.5" y="506.0903">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="544.5" y="506.0903">Remove infra finalizer</text><polygon fill="#A80036" points="162,549.2891,152,553.2891,162,557.2891,158,553.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="509.5" y1="553.2891" y2="553.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="168" y="548.2231">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="190" y="548.2231">patch</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="193" y1="582.4219" y2="582.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="193" x2="193" y1="582.4219" y2="595.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="152" x2="193" y1="595.4219" y2="595.4219"/><polygon fill="#A80036" points="162,591.4219,152,595.4219,162,599.4219,158,595.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="158" y="577.356">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="180" y="577.356">Delete infra cluster</text><!--MD5=[658c2ee820c2da6df41292cd72e55030]
@startuml
autonumber
actor User
database APIServer
control CAPIController
control InfraClusterController
participant gc_service
collections other_services
participant network_service
participant aws
User -> APIServer: delete cluster
CAPIController -> APIServer: watch
activate CAPIController
CAPIController -> APIServer: delete infra (set timestamp)

InfraClusterController -> APIServer: watch (delete)
activate InfraClusterController
InfraClusterController -> other_services: Reconcile Delete 
other_services -> aws: Delete non-network infra
opt if InfraCluster has gc finalizer
    InfraClusterController -> gc_service: ReconcileDelete
    gc_service -> aws: Delete tenant created resources (lb/sg)
    gc_service -> gc_service: remove gc finalizer
    gc_service -> APIServer: patch infracluster
end
InfraClusterController -> network_service: Reconcile Delete
network_service -> aws: delete network infra
InfraClusterController -> InfraClusterController: Remove infra finalizer
InfraClusterController -> APIServer: patch
deactivate InfraClusterController
deactivate CAPIController
APIServer -> APIServer: Delete infra cluster

@enduml

PlantUML version 1.2020.16(Sun Aug 23 20:20:43 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>